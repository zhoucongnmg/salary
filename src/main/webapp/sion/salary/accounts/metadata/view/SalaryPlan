{
    "type": "Ext.window.Window",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "container|align": "stretch",
        "designer|userClassName": "SalaryPlan",
        "height": 600,
        "layout": "vbox",
        "title": "方案信息",
        "width": 800
    },
    "name": "MyWindow",
    "designerId": "fdfc7c61-6d60-4c22-aeab-ad8e1f75d827",
    "cn": [
        {
            "type": "Ext.toolbar.Toolbar",
            "reference": {
                "name": "dockedItems",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "dock": "top"
            },
            "name": "MyToolbar4",
            "designerId": "432f8fdc-9595-4df0-a134-ecfbdd014a29",
            "cn": [
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "iconCls": "s_icon_table_save",
                        "layout|flex": null,
                        "text": "保存",
                        "width": 70
                    },
                    "name": "MyButton5",
                    "designerId": "0588b237-ac4c-4165-9ac1-faa9a1df1f3f",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onButtonClick",
                                "implHandler": [
                                    "var me = this,",
                                    "    namespace = me.getNamespace(),",
                                    "    form = me.down(\"form\"),",
                                    "    store = Ext.getStore(\"Account\"),",
                                    "    itemGrid = me.down('#itemGrid'),",
                                    "    itemList = [],",
                                    "    account = me._account;",
                                    "    itemStore = itemGrid.getStore();",
                                    "",
                                    "record = form.getRecord();",
                                    "form.updateRecord(record);",
                                    "if(!me.down('#name').isValid()){",
                                    "    Ext.Msg.alert(\"提示\", \"信息不完整，请继续填写！\");",
                                    "    return false;",
                                    "}",
                                    "itemStore.each(function(item){",
                                    "    itemList.push(item.data);",
                                    "});",
                                    "record.set('accountItems', itemList);",
                                    "record.set('persons', null);",
                                    "// if(record.get('id') === ''){",
                                    "//     store.add(record);",
                                    "// }",
                                    "if(account){",
                                    "    Ext.Msg.confirm('提示', '是否更新工资条？', function(text){",
                                    "        if(text == 'yes'){",
                                    "            record.set('updatePayroll', true);",
                                    "        }else{",
                                    "            record.set('updatePayroll', false);",
                                    "        }",
                                    "        me.save(store);",
                                    "    });",
                                    "}else{",
                                    "    store.add(record);",
                                    "    me.save(store);",
                                    "}",
                                    ""
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "name": "onButtonClick",
                            "designerId": "d64e1016-9c52-4203-be5b-0a742d39a80b"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.form.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "bodyPadding": 10,
                "header": false,
                "title": null
            },
            "name": "MyForm",
            "designerId": "4043a29c-52b5-451b-95e2-9179de37f450",
            "cn": [
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "allowBlank": false,
                        "fieldLabel": "方案名称",
                        "itemId": "name",
                        "layout|anchor": "100%",
                        "name": "name"
                    },
                    "name": "MyTextField2",
                    "designerId": "1454af2d-e58e-472d-bf1c-a139880d5584"
                },
                {
                    "type": "Ext.form.field.TextArea",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fieldLabel": "备注",
                        "layout|anchor": "100%",
                        "name": "remark"
                    },
                    "name": "MyTextArea2",
                    "designerId": "ebc4ba2a-fd78-4b01-b828-c273f5b7e83d"
                }
            ]
        },
        {
            "type": "Ext.grid.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "header": false,
                "height": 450,
                "itemId": "itemGrid",
                "layout|flex": 1,
                "store": "AccountItem",
                "title": "方案项目 "
            },
            "name": "MyGridPanel2",
            "designerId": "d92f684f-f79a-4616-8eb2-1af6b9c15e5b",
            "cn": [
                {
                    "type": "Ext.grid.RowNumberer",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "flex": 1,
                        "text": "序号"
                    },
                    "name": "MyRowNumberer",
                    "designerId": "459c31e6-74a1-4dd2-913b-280c77bf4736"
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "name",
                        "flex": 3,
                        "text": "项目名称"
                    },
                    "name": "MyColumn8",
                    "designerId": "f0e6e516-a329-49a5-b332-370a755ad747"
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "type",
                        "flex": 2,
                        "text": "项目类型"
                    },
                    "name": "MyColumn10",
                    "designerId": "f61358ba-c1f8-465f-8eff-8887d3f61cdf",
                    "cn": [
                        {
                            "type": "fixedfunction",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|params": [
                                    "value",
                                    "metaData",
                                    "record",
                                    "rowIndex",
                                    "colIndex",
                                    "store",
                                    "view"
                                ],
                                "fn": "renderer",
                                "implHandler": [
                                    "var store = Ext.getStore(\"AccountItemType\"),",
                                    "    rec = store.findRecord('id', value);",
                                    "",
                                    "return rec.get(\"name\");"
                                ]
                            },
                            "name": "renderer",
                            "designerId": "2eb85934-bc5e-41e8-9b2c-9a1323c4b346"
                        }
                    ]
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "value",
                        "flex": 6,
                        "text": "值或计算公式"
                    },
                    "name": "MyColumn12",
                    "designerId": "86645e7b-4389-46d4-afcd-b646c42903c8"
                },
                {
                    "type": "Ext.grid.column.Boolean",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "show",
                        "falseText": "否",
                        "flex": 4,
                        "text": "是否在工资条中显示",
                        "trueText": "是"
                    },
                    "name": "MyBooleanColumn3",
                    "designerId": "bb392920-1b19-4c19-8fc1-97ebf3e66512"
                },
                {
                    "type": "Ext.grid.column.Action",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "date",
                        "enableColumnHide": null,
                        "flex": 2,
                        "hideable": false,
                        "text": "操作"
                    },
                    "name": "MyActionColumn3",
                    "designerId": "077a62d6-ef03-4d58-a2a9-466980f39297",
                    "cn": [
                        {
                            "type": "actioncolumnitem",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|displayName": "modify",
                                "iconCls": "s_icon_page_edit",
                                "tooltip": "修改"
                            },
                            "name": "MyActionColumnItem9",
                            "designerId": "b51ce6fd-780a-4e29-9fd4-0515d17056e6",
                            "cn": [
                                {
                                    "type": "fixedfunction",
                                    "reference": {
                                        "name": "items",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "designer|params": [
                                            "view",
                                            "rowIndex",
                                            "colIndex",
                                            "item",
                                            "e",
                                            "record",
                                            "row"
                                        ],
                                        "fn": "handler",
                                        "implHandler": [
                                            "var panel = this.up('panel').up('panel');",
                                            "",
                                            "panel.detail(record);"
                                        ]
                                    },
                                    "name": "handler",
                                    "designerId": "4b01f7d7-af4c-4d36-9e88-97d9af268b66"
                                }
                            ]
                        },
                        {
                            "type": "actioncolumnitem",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|displayName": "delete",
                                "iconCls": "s_icon_cross",
                                "tooltip": "删除"
                            },
                            "name": "MyActionColumnItem10",
                            "designerId": "6ddd5caf-ca2f-4793-b2a9-9e84fc8bfc9d",
                            "cn": [
                                {
                                    "type": "fixedfunction",
                                    "reference": {
                                        "name": "items",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "designer|params": [
                                            "view",
                                            "rowIndex",
                                            "colIndex",
                                            "item",
                                            "e",
                                            "record",
                                            "row"
                                        ],
                                        "fn": "handler",
                                        "implHandler": [
                                            "// var store = Ext.getStore('AccountItem');",
                                            "var store = view.getStore();",
                                            "",
                                            "Ext.Msg.confirm('提示', '确定要删除吗？', function(text){",
                                            "    if (text == 'yes'){",
                                            "        store.remove(record);",
                                            "    }",
                                            "});"
                                        ]
                                    },
                                    "name": "handler",
                                    "designerId": "5f0987b0-9bd2-4ac1-a41b-341c8bbceadb"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "Ext.grid.View",
                    "reference": {
                        "name": "viewConfig",
                        "type": "object"
                    },
                    "codeClass": null,
                    "name": "MyGridView3",
                    "designerId": "fc7f4ea7-67ab-4e98-9022-4a034c8e55ee"
                },
                {
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onItemGridItemDblClick",
                        "implHandler": [
                            "this.detail(record);"
                        ],
                        "name": "itemdblclick",
                        "scope": "me"
                    },
                    "name": "onItemGridItemDblClick",
                    "designerId": "bd048dcd-b121-4254-ba8d-b02d8d6c80d0"
                },
                {
                    "type": "Ext.toolbar.Toolbar",
                    "reference": {
                        "name": "dockedItems",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dock": "top"
                    },
                    "name": "MyToolbar7",
                    "designerId": "3a9e6909-b616-434f-afe4-84e24ccffc7e",
                    "cn": [
                        {
                            "type": "Ext.form.Label",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "html": "<span style='font-weight:bold'>薪资项目</span>",
                                "layout|flex": null,
                                "text": null
                            },
                            "name": "MyLabel",
                            "designerId": "1d20282e-f4c0-49e0-8066-a5fd63ac9caf"
                        },
                        {
                            "type": "Ext.toolbar.Fill",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "layout|flex": null
                            },
                            "name": "MyFill",
                            "designerId": "a885880f-1c50-46d4-b2d4-3a02aac85295"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "iconCls": "s_icon_action_add",
                                "layout|flex": null,
                                "text": "新增",
                                "width": null
                            },
                            "name": "MyButton4",
                            "designerId": "19cee27d-252e-45b7-9f79-3e9d93ca0587",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onAddSalaryItemClick",
                                        "implHandler": [
                                            "this.detail(null);"
                                        ],
                                        "name": "click",
                                        "scope": "me"
                                    },
                                    "name": "onAddSalaryItemClick",
                                    "designerId": "b0a7a897-e88a-4be3-a7ac-378da9995402"
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onWindowBeforeRender",
                "implHandler": [
                    "var me = this,",
                    "    store = Ext.getStore('SalaryItem');",
                    "",
                    "store.clearFilter(true);",
                    "Ext.apply(store.proxy.extraParams, {",
                    "    type : ''",
                    "});",
                    "// if(store.getCount() === 0){",
                    "store.load({",
                    "    callback: function(records, operation, success) {",
                    "        me.loadData(store);",
                    "    }",
                    "});",
                    "// }else{",
                    "//     me.loadData(store);",
                    "// }"
                ],
                "name": "beforerender",
                "scope": "me"
            },
            "name": "onWindowBeforeRender",
            "designerId": "da5ed7bd-a9bf-4d4b-9881-0709f951eb5c"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "detail",
                "implHandler": [
                    "var me = this,",
                    "    grid = me.down('grid'),",
                    "    namespace = me.getNamespace();",
                    "//     accountItem = Ext.create(namespace + '.model.AccountItem');",
                    "",
                    "Ext.create(namespace+\".view.AddSalaryItem\", {",
                    "    //     _account : me._account,",
                    "    _accountItem : record,",
                    "    _store : grid.getStore()",
                    "}).show();"
                ]
            },
            "name": "detail",
            "designerId": "f46ded6e-a79f-432e-b1c1-2b69ea191b45"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "id"
                ],
                "fn": "getFormula",
                "implHandler": [
                    "// if(record !== null && record.get('type') == 'Calculate' && record.get('formulaId') !== ''){",
                    "    Ext.Ajax.request({",
                    "        url: 'salary/formula/read',",
                    "        method: 'get',",
                    "        async: false,    //不使用异步",
                    "        params: {",
                    "            id: id",
                    "        },",
                    "        success: function(response, opts){",
                    "            var data = Ext.JSON.decode(response.responseText);",
                    "            alert(data);",
                    "            console.log(data);",
                    "            return data;",
                    "//             record.set('formula', data);",
                    "        },",
                    "        failure: function(response, opts) {",
                    "            Ext.Msg.alert('提示信息','数据请求错误，请稍候重新尝试获取数据……');",
                    "        }",
                    "    });",
                    "// }"
                ]
            },
            "name": "getFormula",
            "designerId": "a4e813ab-01cc-4c4e-8876-eece2e4aff7d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "store"
                ],
                "fn": "save",
                "implHandler": [
                    "var me = this;",
                    "",
                    "store.sync({",
                    "    success: function(response, opts){",
                    "        Ext.Msg.alert(\"提示\", \"保存成功\");",
                    "        store.load();",
                    "        me.close();",
                    "    },",
                    "    failure: function(){",
                    "        Ext.Msg.alert(\"提示\", \"保存失败\");",
                    "        me.close();",
                    "    }",
                    "});"
                ]
            },
            "name": "save",
            "designerId": "9d307f19-551e-477c-baa4-5e86e0597d08"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "store"
                ],
                "fn": "loadData",
                "implHandler": [
                    "var me = this,",
                    "    namespace = me.getNamespace(),",
                    "    grid = me.down('grid'),",
                    "    itemStore = grid.getStore(),",
                    "    form = me.down(\"form\"),",
                    "    account = me._account;",
                    "",
                    "itemStore.removeAll();",
                    "if(account){",
                    "    Ext.Array.each(account.get('accountItems'), function(item){",
                    "        if(item !== null && item.type == 'Calculate' && item.formulaId !== ''){",
                    "            Ext.Ajax.request({",
                    "                url: 'salary/formula/read',",
                    "                method: 'get',",
                    "                async: false,    //不使用异步",
                    "                params: {",
                    "                    id: item.formulaId",
                    "                },",
                    "                success: function(response, opts){",
                    "                    if(response.responseText !== ''){",
                    "                        var data = Ext.JSON.decode(response.responseText);",
                    "                        item.formula = data;",
                    "                    }",
                    "                },",
                    "                failure: function(response, opts) {",
                    "                    Ext.Msg.alert('提示信息','数据请求错误，请稍候重新尝试获取数据……');",
                    "                }",
                    "            });",
                    "        }else{",
                    "            item.formula = null;",
                    "        }",
                    "        var salaryItem = store.findRecord('id', item.salaryItemId);",
                    "        item.name = salaryItem.get('name');",
                    "        itemStore.add(item);",
                    "    });",
                    "    form.loadRecord(account);",
                    "}else{",
                    "    form.loadRecord(Ext.create(namespace + '.model.Account', {",
                    "        id: '',",
                    "        name: ''",
                    "    }));",
                    "}"
                ]
            },
            "name": "loadData",
            "designerId": "2b18475e-230e-4a51-9c09-fa9931a98271"
        }
    ]
}