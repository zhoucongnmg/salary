/*
 * File: app/controller/Api.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('sion.salary.formula.controller.Api', {
    extend: 'Ext.app.Controller',

    getFormula: function() {
        var me = this,
            conifg = me._config,
            formulaId = config._formulaId,
            ctrl = me.getTerminalCtrl(),
            term = ctrl.getTerm(formulaId);


        return term._history;

    },

    validateFormula: function() {
        var me = this,
            conifg = me._config,
            formulaId = config._formulaId,
            ctrl = me.getTerminalCtrl(),
            validator = me.getValidatorCtrl(),
            command = ctrl.getCommand(formulaId);

        return validator.validate(command,config._store);
    },

    getFields: function() {
        var me = this,
            conifg = me._config,
            store = config._store,
            json = [];

        store.each(function(record,index) {
            var text = record.get('name');
            if (str.indexOf('[' + text + ']')>-1){
                json.push({
                    fieldId : record.get('id'),
                    text : text
                });
            }

        });
        return json;
    },

    initFormula: function(config) {
        /**
         config : {
             _formulaId : //窗口的ItemId
             _container :  //需要将公式编辑器面板显示到哪一个Container中
             _store : //计算项store(Model必须包含id,text等field)

         }
         **/
        Ext.util.CSS.swapStyleSheet('formula-base','sion/salary/formula/resources/formula.css');
        Ext.util.CSS.swapStyleSheet('formula-terminal','sion/salary/formula/jqueryTerminal/terminal.css');
        Ext.util.CSS.swapStyleSheet('formula-terminal-base','sion/salary/formula/jqueryTerminal/style.css');


        var me = this,
            container = config._container,
            ns = me.getNamespace(),
            main,win;

        me._config = config;
        if (container) {
            main = Ext.create(ns + '.view.Main',{
                _store : config._store,
                _formulaId : config._formulaId
            });
            container.add(main);
        }else {
            win = Ext.create(ns + '.view.FormulaWin',{
                _store : config._store,
                _formulaId : config._formulaId
            });
            win.show();
        }


    },

    getTerminalCtrl: function() {
        return this.getController('Terminal');
    },

    getValidatorCtrl: function() {

        return this.getController('Validator');

    }

});
