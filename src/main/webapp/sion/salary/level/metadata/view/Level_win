{
    "type": "Ext.window.Window",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Level_win",
        "height": 640,
        "layout": "fit",
        "title": "薪资层次",
        "width": 780
    },
    "name": "MyWindow",
    "configAlternates": {
        "itemModel": "object"
    },
    "designerId": "edfd2dfd-871c-48f5-82b3-d51a9ac89754",
    "cn": [
        {
            "type": "Ext.toolbar.Toolbar",
            "reference": {
                "name": "dockedItems",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "dock": "top"
            },
            "name": "MyToolbar1",
            "designerId": "691c32df-8841-4882-b486-0c34ec6aeed8",
            "cn": [
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": null,
                        "text": "保存"
                    },
                    "name": "MyButton1",
                    "designerId": "7a18fa52-b86c-4fad-a022-b0cc64baadf7",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onSaveClick",
                                "implHandler": [
                                    "var me=this,",
                                    "    namespace=me.getNamespace(),",
                                    "    form=me.down('form'),",
                                    "    grid=me.down('gridpanel'),",
                                    "    store=grid.getStore(),",
                                    "    levelItems=[],",
                                    "    model =me._record?me._record: Ext.create(namespace+'.model.Level');",
                                    "",
                                    "model.set('name',form.down('#name').getValue());",
                                    "",
                                    "//set items",
                                    "store.each(function(record){",
                                    "    var item={id:record.data.id===null?\"\":record.data.id,rank:record.data.rank};",
                                    "    var salaryItemNames=[];",
                                    "    var salaryItemValues=[];",
                                    "",
                                    "    var keys=record.fields.keys;",
                                    "    Ext.Array.each(keys,function(key){",
                                    "        if(key!==\"id\" && key !==\"rank\"){",
                                    "            value={};",
                                    "            value[key]=record.get(key);",
                                    "            salaryItemValues.push(value);",
                                    "            ",
                                    "            var name={};",
                                    "            Ext.Array.each(me._salaryItems,function(salary){",
                                    "                if(key===salary.id){",
                                    "                    name[key]=salary.name;",
                                    "                }",
                                    "            });",
                                    "            ",
                                    "            salaryItemNames.push(name);",
                                    "        }",
                                    "    });",
                                    "    item.salaryItemValues=salaryItemValues;",
                                    "    item.salaryItemNames=salaryItemNames;",
                                    "",
                                    "    levelItems.push(item);",
                                    "});",
                                    "",
                                    "",
                                    "model.set(\"levelItems\",levelItems);",
                                    "",
                                    "",
                                    "",
                                    "Ext.Ajax.request({",
                                    "    url:'salary/level/create',",
                                    "    method:'POST',",
                                    "    jsonData:model.data,",
                                    "    success:function(res){",
                                    "        var responseData=Ext.JSON.decode(res.responseText);",
                                    "        if(responseData.success===true){",
                                    "            if(me._levelGrid){",
                                    "                me._levelGrid.getStore().reload();",
                                    "            }",
                                    "        }",
                                    "        Ext.Msg.alert(\"提示\",responseData.message);",
                                    "        button.disabled=false;",
                                    "        me.close();",
                                    "",
                                    "    },",
                                    "    failure:function(form,action){",
                                    "        Ext.Msg.alert(\"提示\",\"网络通信异常，请联系管理员\");",
                                    "        button.disabled=false;",
                                    "    }",
                                    "});"
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "name": "onSaveClick",
                            "designerId": "6a913d57-04a8-4028-943e-96707a6bc8e4"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.form.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "bodyPadding": 10,
                "header": false,
                "layout": null,
                "title": "My Form"
            },
            "name": "MyForm",
            "designerId": "ccc3685c-d050-41a9-a46e-da383b3bb69e",
            "cn": [
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fieldLabel": "名称",
                        "height": 35,
                        "itemId": "name",
                        "layout|anchor": "100%",
                        "name": "name"
                    },
                    "name": "MyTextField",
                    "designerId": "2947bff6-f30d-450d-afe8-ea93d5702b39"
                },
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "text": "添加等级"
                    },
                    "name": "MyButton4",
                    "designerId": "0be4cee0-2a93-4a51-80c9-44b2314b4034",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onAddRowClick",
                                "implHandler": [
                                    "var me=this,",
                                    "    grid=me.down('gridpanel'),",
                                    "    store=grid.getStore(),",
                                    "    form=me.down('form');",
                                    "",
                                    "var model=Ext.create(me.itemModel);",
                                    "",
                                    "store.add(model);"
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "name": "onAddRowClick",
                            "designerId": "b80a2ce6-b8a6-435a-bec7-13571d60d101"
                        }
                    ]
                },
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "margin": "0 0 0 10",
                        "text": "删除等级"
                    },
                    "name": "MyButton5",
                    "designerId": "ae0150dc-3079-4cd3-ac20-6f8c59651035",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onDeleteClick",
                                "name": "click",
                                "scope": "me"
                            },
                            "name": "onDeleteClick",
                            "designerId": "b6267138-387e-4631-b182-49f10e07ce32"
                        }
                    ]
                },
                {
                    "type": "Ext.form.FieldSet",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout": "fit",
                        "title": null
                    },
                    "name": "MyFieldSet",
                    "designerId": "cc500bb4-32c8-4942-8d83-db3d74186b32",
                    "cn": [
                        {
                            "type": "Ext.grid.Panel",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "header": false,
                                "height": 483,
                                "store": "LevelItemStore",
                                "title": "My Grid Panel"
                            },
                            "name": "MyGridPanel2",
                            "designerId": "97d1c4fb-bfcd-47ff-a0d3-31b2e2d4d8e3",
                            "cn": [
                                {
                                    "type": "Ext.grid.column.Column",
                                    "reference": {
                                        "name": "columns",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "dataIndex": "rank",
                                        "text": "等级"
                                    },
                                    "name": "MyColumn7",
                                    "designerId": "9fb702d4-dac6-4183-aa64-11e0c61d5749",
                                    "cn": [
                                        {
                                            "type": "Ext.form.field.Text",
                                            "reference": {
                                                "name": "editor",
                                                "type": "object"
                                            },
                                            "codeClass": null,
                                            "name": "MyTextField2",
                                            "designerId": "bd6e8b59-8436-42dd-8785-2dbf9dcedfed"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.grid.View",
                                    "reference": {
                                        "name": "viewConfig",
                                        "type": "object"
                                    },
                                    "codeClass": null,
                                    "name": "MyGridView2",
                                    "designerId": "7ebe6658-da42-4614-89df-0cb15278f1cb"
                                },
                                {
                                    "type": "Ext.grid.plugin.RowEditing",
                                    "reference": {
                                        "name": "plugins",
                                        "type": "array"
                                    },
                                    "codeClass": "Ext.grid.plugin.RowEditing",
                                    "name": "MyRowEditingPlugin",
                                    "designerId": "64367b8b-0cf1-40bf-840d-39f551aa7cc2",
                                    "cn": [
                                        {
                                            "type": "basiceventbinding",
                                            "reference": {
                                                "name": "listeners",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "fn": "onRowEditingEdit",
                                                "name": "edit",
                                                "scope": "me"
                                            },
                                            "name": "onRowEditingEdit",
                                            "designerId": "99afc3dc-91e8-4948-aa45-1c57eec2825c"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onWindowAfterRender",
                "implHandler": [
                    "var me=this,",
                    "    grid=me.down('gridpanel'),",
                    "    store=grid.getStore(),columns=new Array(),",
                    "    form=me.down('form');",
                    "",
                    "",
                    "",
                    "",
                    "// model=Ext.create(me.itemModel);",
                    "// model.set(\"rank\",\"level2\");",
                    "// model.set(\"task1\",\"12\");",
                    "// model.set('task2',\"123\");",
                    "// store.add(model);",
                    "",
                    "//Danymic columns",
                    "Ext.suspendLayouts();",
                    "",
                    "var cols=grid.columns;",
                    "Ext.Array.each(cols,function(c){",
                    "    columns.push({text:c.text,dataIndex:c.dataIndex,editor:c.editor});",
                    "});",
                    "",
                    "Ext.Array.each(me._salaryItems,function(salary){",
                    "    columns.push({text:salary.name,dataIndex:salary.id,editor: {",
                    "        xtype: 'numberfield'",
                    "    }});",
                    "});",
                    "",
                    "grid.reconfigure(store, columns);",
                    "Ext.resumeLayouts(true);",
                    "",
                    "//set value",
                    "if(me._record){",
                    "    form.getForm().setValues(me._record.data);",
                    "",
                    "    var levelItems=me._record.data.levelItems;",
                    "    Ext.Array.each(levelItems,function(item){",
                    "        var model=Ext.create(me.itemModel);",
                    "            model.set(\"rank\",item.rank);",
                    "        ",
                    "        var salaryItemValues=item.salaryItemValues,",
                    "            salaryItemNames=item.salaryItemNames;",
                    "",
                    "        Ext.Array.each(salaryItemValues,function(value){",
                    "            var key=Object.keys(value)[0];",
                    "            model.set(key,value[key]);",
                    "        }); ",
                    "         store.add(model);",
                    "    });",
                    "",
                    "",
                    "",
                    "}",
                    "",
                    "//set grid value",
                    ""
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "name": "onWindowAfterRender",
            "designerId": "b5056d9a-87f1-4a15-b5ea-af82eec3fb0a"
        },
        {
            "type": "processcfgfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "config"
                ],
                "fn": "processLevel_win",
                "implHandler": [
                    "",
                    "var fields = [];",
                    "",
                    "",
                    "fields.push({name:\"id\"});",
                    "fields.push({name:\"rank\"});",
                    "",
                    "Ext.Ajax.request({",
                    "    url:'salary/level/getSalaryItem',",
                    "    method:'get',",
                    "    timeout:4000,",
                    "    async:false,    //不使用异步",
                    "    success:function(response, opts){",
                    "",
                    "        var items=Ext.JSON.decode(response.responseText);",
                    "        config._salaryItems=items;",
                    "        Ext.Array.each(items,function(f){",
                    "            fields.push({\"name\":f.id,\"displayname\":f.name});",
                    "        });",
                    "    },",
                    "    failure: function(response, opts) {",
                    "        Ext.Msg.alert('提示信息','数据请求错误，请稍候重新尝试获取数据……');",
                    "    }",
                    "});",
                    "",
                    "",
                    "config.itemModel=Ext.define(\"sion.salary.level.model.LevelItem\", {",
                    "    extend:'Ext.data.Model',",
                    "    fields:fields",
                    "});",
                    "return config;"
                ]
            },
            "name": "processLevel_win",
            "designerId": "e183f7b0-2a0e-4132-9734-426c2d76ad42"
        },
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onWindowBeforeClose",
                "implHandler": [
                    "var me=this,",
                    "    grid=me.down('gridpanel'),",
                    "    store=grid.getStore();",
                    "store.removeAll();"
                ],
                "name": "beforeclose",
                "scope": "me"
            },
            "name": "onWindowBeforeClose",
            "designerId": "526f7546-b8b4-4129-b72a-afabff4dbbdd"
        }
    ]
}