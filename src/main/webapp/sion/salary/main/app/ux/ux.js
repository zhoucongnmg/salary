Ext.define("Ext.ux.DataView.Animated",{defaults:{duration:750,idProperty:"id"},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.dataview=a;var c=this.idProperty,b=a.store;a.blockRefresh=true;a.updateIndexes=Ext.Function.createSequence(a.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(f,g,e){f.id=f.dom.id=Ext.util.Format.format("{0}-{1}",a.id,b.getAt(e).internalId)},this)},a);this.dataviewID=a.id;this.cachedStoreData={};this.cacheStoreData(b.data||b.snapshot);a.on("resize",function(){var e=a.store;if(e.getCount()>0){}},this);a.store.on("datachanged",d,this);function d(n){var l=a.getTargetEl(),h=n.getAt(0),p=this.getAdded(n),x=this.getRemoved(n),i=this.getRemaining(n),u=Ext.apply({},i,p);Ext.each(x,function(C){var D=this.dataviewID+"-"+C.internalId;Ext.fly(D).animate({remove:false,duration:e,opacity:0,useDisplay:true,callback:function(){Ext.fly(D).setDisplayed(false)}})},this);if(h==undefined){this.cacheStoreData(n);return}this.cacheStoreData(n);var g=Ext.get(this.dataviewID+"-"+h.internalId);if(!g){a.refresh();return true}var z=n.getCount(),k=g.getMargin("lr")+g.getWidth(),v=g.getMargin("bt")+g.getHeight(),r=l.getWidth(),f=Math.floor(r/k),q=Math.ceil(z/f),A=Math.ceil(this.getExistingCount()/f);var j={},B={},s={};Ext.iterate(i,function(E,D){var E=D.internalId,C=s[E]=Ext.get(this.dataviewID+"-"+E);j[E]={top:C.getY()-l.getY()-C.getMargin("t")-l.getPadding("t"),left:C.getX()-l.getX()-C.getMargin("l")-l.getPadding("l")}},this);l.applyStyles({display:"block",position:"relative"});Ext.iterate(i,function(F,E){var C=j[F],D=s[F];if(D.getStyle("position")!="absolute"){s[F].applyStyles({position:"absolute",left:C.left+"px",top:C.top+"px"})}});var o=0;Ext.iterate(n.data.items,function(E){var I=E.internalId,D=s[I];var C=o%f,H=Math.floor(o/f),G=H*v,F=C*k;B[I]={top:G,left:F};o++},this);var t=new Date(),e=this.duration,m=this.dataviewID;var y=function(){var L=new Date()-t,N=L/e,C;if(N>=1){for(C in B){Ext.fly(m+"-"+C).applyStyles({top:B[C].top+"px",left:B[C].left+"px"})}Ext.TaskManager.stop(w)}else{for(C in B){if(!i[C]){continue}var F=j[C],I=B[C],G=F.top,J=I.top,E=F.left,K=I.left,H=N*Math.abs(G-J),M=N*Math.abs(E-K),O=G>J?G-H:G+H,D=E>K?E-M:E+M;Ext.fly(m+"-"+C).applyStyles({top:O+"px",left:D+"px"}).setDisplayed(true)}}};var w={run:y,interval:20,scope:this};Ext.TaskManager.start(w);Ext.iterate(p,function(D,C){Ext.fly(this.dataviewID+"-"+C.internalId).applyStyles({top:B[C.internalId].top+"px",left:B[C.internalId].left+"px"}).setDisplayed(true);Ext.fly(this.dataviewID+"-"+C.internalId).animate({remove:false,duration:e,opacity:1})},this);this.cacheStoreData(n)}},cacheStoreData:function(a){this.cachedStoreData={};a.each(function(b){this.cachedStoreData[b.internalId]=b},this)},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var c=0,b=this.getExisting();for(var a in b){c++}return c},getAdded:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]==undefined){b[c.internalId]=c}},this);return b},getRemoved:function(a){var b=[],c;for(c in this.cachedStoreData){if(a.findBy(function(d){return d.internalId==c})==-1){b.push(this.cachedStoreData[c])}}return b},getRemaining:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]!=undefined){b[c.internalId]=c}},this);return b}});Ext.define("Ext.ux.DataView.DragSelector",{requires:["Ext.dd.DragTracker","Ext.util.Region"],init:function(a){this.dataview=a;a.mon(a,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:true}})},onRender:function(){this.tracker=Ext.create("Ext.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.dragRegion=Ext.create("Ext.util.Region")},onBeforeStart:function(a){return a.target==this.dataview.getEl().dom},onStart:function(b){var c=this.dragSelector,a=this.dataview;this.dragging=true;c.fillRegions();c.getProxy().show();a.getSelectionModel().deselectAll()},cancelClick:function(){return !this.tracker.dragging},onDrag:function(l){var b=this.dragSelector,k=b.dataview.getSelectionModel(),q=b.dragRegion,p=b.bodyRegion,n=b.getProxy(),g=b.regions,c=g.length,m=this.startXY,s=this.getXY(),f=Math.min(m[0],s[0]),d=Math.min(m[1],s[1]),a=Math.abs(m[0]-s[0]),r=Math.abs(m[1]-s[1]),o,h,j;Ext.apply(q,{top:d,left:f,right:f+a,bottom:d+r});q.constrainTo(p);n.setRegion(q);for(j=0;j<c;j++){o=g[j];h=q.intersect(o);if(h){k.select(j,true)}else{k.deselect(j)}}},onEnd:Ext.Function.createDelayed(function(c){var a=this.dataview,b=a.getSelectionModel(),d=this.dragSelector;this.dragging=false;d.getProxy().hide()},1),getProxy:function(){if(!this.proxy){this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"})}return this.proxy},fillRegions:function(){var a=this.dataview,b=this.regions=[];a.all.each(function(c){b.push(c.getRegion())});this.bodyRegion=a.getEl().getRegion()}});Ext.define("Ext.ux.DataView.Draggable",{requires:"Ext.dd.DragZone",ghostCls:"x-dataview-draggable-ghost",ghostTpl:['<tpl for=".">',"{title}","</tpl>"],init:function(a,b){this.dataview=a;a.on("render",this.onRender,this);Ext.apply(this,{itemSelector:a.itemSelector,ghostConfig:{}},b||{});Ext.applyIf(this.ghostConfig,{itemSelector:"img",cls:this.ghostCls,tpl:this.ghostTpl})},onRender:function(){var a=Ext.apply({},this.ddConfig||{},{dvDraggable:this,dataview:this.dataview,getDragData:this.getDragData,getTreeNode:this.getTreeNode,afterRepair:this.afterRepair,getRepairXY:this.getRepairXY});this.dragZone=Ext.create("Ext.dd.DragZone",this.dataview.getEl(),a)},getDragData:function(h){var a=this.dvDraggable,b=this.dataview,c=b.getSelectionModel(),g=h.getTarget(a.itemSelector),d,f;if(g){if(!b.isSelected(g)){c.select(b.getRecord(g))}d=b.getSelectedNodes();f={copy:true,nodes:d,records:c.getSelection(),item:true};if(d.length==1){f.single=true;f.ddel=g}else{f.multi=true;f.ddel=a.prepareGhost(c.getSelection()).dom}return f}return false},getTreeNode:function(){},afterRepair:function(){this.dragging=false;var a=this.dragData.nodes,c=a.length,b;for(b=0;b<c;b++){Ext.get(a[b]).frame("#8db2e3",1)}},getRepairXY:function(c){if(this.dragData.multi){return false}else{var a=Ext.get(this.dragData.ddel),b=a.getXY();b[0]+=a.getPadding("t")+a.getMargin("t");b[1]+=a.getPadding("l")+a.getMargin("l");return b}},prepareGhost:function(b){var c=this.createGhost(b),a=c.store;a.removeAll();a.add(b);return c.getEl()},createGhost:function(b){if(!this.ghost){var a=Ext.apply({},this.ghostConfig,{store:Ext.create("Ext.data.Store",{model:b[0].modelName})});this.ghost=Ext.create("Ext.view.View",a);this.ghost.render(document.createElement("div"))}return this.ghost}});Ext.define("Ext.ux.DataView.LabelEditor",{extend:"Ext.Editor",alignment:"tl-tl",completeOnEnter:true,cancelOnEsc:true,shim:false,autoSize:{width:"boundEl",height:"field"},labelSelector:"x-editable",requires:["Ext.form.field.Text"],constructor:function(a){a.field=a.field||Ext.create("Ext.form.field.Text",{allowBlank:false,selectOnFocus:true});this.callParent([a])},init:function(a){this.view=a;this.mon(a,"render",this.bindEvents,this);this.on("complete",this.onSave,this)},bindEvents:function(){this.mon(this.view.getEl(),{click:{fn:this.onClick,scope:this}})},onClick:function(f,d){var c=this,b,a;if(Ext.fly(d).hasCls(c.labelSelector)&&!c.editing&&!f.ctrlKey&&!f.shiftKey){f.stopEvent();b=c.view.findItemByChild(d);a=c.view.store.getAt(c.view.indexOf(b));c.startEdit(d,a.data[c.dataIndex]);c.activeRecord=a}else{if(c.editing){c.field.blur();f.preventDefault()}}},onSave:function(a,b){this.activeRecord.set(this.dataIndex,b)}});Ext.define("Ext.ux.DataView.FileBrowser",{extend:"Ext.view.View",alias:"widget.filebrowser",xtype:"filebrowser",trackOver:true,multiSelect:false,autoScroll:true,itemSelector:"div.thumbchooser-wrap",overItemCls:"x-view-over",mixins:{dragSelector:"Ext.ux.DataView.DragSelector",draggable:"Ext.ux.DataView.Draggable"},plugins:[Ext.create("Ext.ux.DataView.DragSelector",{}),Ext.create("Ext.ux.DataView.LabelEditor",{dataIndex:"customName"})],tpl:['<tpl for=".">','    <div class="thumbchooser-wrap">','        <div class="thumbchooser">','            <img src="resources/images/fileManage/file/{extName}.png"/>',"        </div>","        <span>{[Ext.util.Format.ellipsis(values.customName.toString(),15)]}</span>","    </div>","</tpl>"],initComponent:function(){var a=this;Ext.applyIf(a,{});this.mixins.dragSelector.init(this);this.mixins.draggable.init(this,{ddConfig:{ddGroup:"organizerDD"},ghostTpl:['<tpl for=".">','<img src="../resources/images/file/{extName}.jpg" />','<tpl if="xindex % 4 == 0"><br /></tpl>',"</tpl>",'<div class="count">',"{[values.length]} images selected","<div>"]});a.callParent(arguments)}});Ext.override(Ext.ZIndexManager,{tempHidden:[],show:function(){var b,a,c;while(b=this.tempHidden.shift()){a=b.x;c=b.y;b.show();b.setPosition(a,c)}}});Ext.override(Ext.tab.Bar,{setActiveTab:function(a){if(a.disabled){return}var b=this;if(b.activeTab){b.previousTab=b.activeTab;b.activeTab.deactivate()}a.activate();if(b.rendered){a.el.scrollIntoView(b.layout.getRenderTarget())}b.activeTab=a;b.fireEvent("change",b,a,a.card)},closeTab:function(c){var d=this,b=c.card,e=d.tabPanel,a;if(b&&b.fireEvent("beforeclose",b)===false){return false}if(c.active&&d.items.getCount()>1){a=d.previousTab||c.next("tab")||d.items.items[0];d.setActiveTab(a);if(e){e.setActiveTab(a.card)}}c.fireClose();d.remove(c);if(e&&b){b.fireEvent("close",b);e.remove(b)}if(a){a.focus()}}});Ext.define("Ext.ux.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:"text",columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100,rootVisible:false,root:null},editable:false,initComponent:function(){var a=this;this.addEvents("select");if(Ext.isString(a.store)){a.store=Ext.StoreMgr.lookup(a.store)}else{if(!a.store||Ext.isObject(a.store)&&!a.store.isStore){a.store=new Ext.data.TreeStore(Ext.apply({},a.store||{},{root:a.root,fields:a.fields,model:a.model,folderSort:a.folderSort}))}else{if(a.root){a.store=Ext.data.StoreManager.lookup(a.store);a.store.setRootNode(a.root);if(a.folderSort!==undefined){a.store.folderSort=a.folderSort;a.store.sort()}}}}a.store.on("load",a.onLoad,a);a.callParent(arguments)},createPicker:function(){var c=this,b=Ext.create("Ext.tree.Panel",{store:c.store,floating:true,displayField:c.displayField,rootVisible:c.rootVisible,root:c.root,columns:c.columns,maxHeight:c.maxTreeHeight,shadow:false,listeners:{itemclick:Ext.bind(c.onItemClick,c)},viewConfig:{listeners:{render:function(d){d.getEl().on("keypress",c.onPickerKeypress,c)}}}}),a=b.getView();c.store=b.store;a.on("render",c.setPickerViewStyles,c);if(Ext.isIE9&&Ext.isStrict){a.on("highlightitem",c.repaintPickerView,c);a.on("unhighlightitem",c.repaintPickerView,c);a.on("afteritemexpand",c.repaintPickerView,c);a.on("afteritemcollapse",c.repaintPickerView,c)}return b},setPickerViewStyles:function(a){a.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display},alignPicker:function(){var b=this,a;if(b.isExpanded){a=b.getPicker();if(b.matchFieldWidth){a.setWidth(b.bodyEl.getWidth())}if(a.isFloating()){b.doAlign()}}},onItemClick:function(b,a,c,f,d){this.selectItem(a)},onPickerKeypress:function(c,b){var a=c.getKey();if(a===c.ENTER||(a===c.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(a){var b=this;b.setValue(a.get("id"));b.picker.hide();b.inputEl.focus();b.fireEvent("select",b,a)},onExpand:function(){var c=this,b=c.picker,a=b.store,d=c.value;if(d){b.selectPath(a.getNodeById(d).getPath())}else{b.getSelectionModel().select(a.getRootNode())}Ext.defer(function(){b.getView().focus()},1)},setValue:function(c){var b=this,a;b.value=c;if(b.store.loading){return b}a=c?b.store.getNodeById(c):b.store.getRootNode();b.setRawValue(a?a.get(this.displayField):"");return b},getValue:function(){return this.value},onLoad:function(){var a=this.value;if(a){this.setValue(a)}}});Ext.define("Ext.ux.TreePickerFilter",{extend:"Ext.form.field.Picker",xtype:"treepickerFilter",triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100,rootVisible:true},editable:false,initComponent:function(){var a=this;a.callParent(arguments);this.addEvents("select");a.store.on("load",a.onLoad,a)},createPicker:function(){var c=this,b=Ext.create("Ext.tree.Panel",{store:c.store,floating:false,hidden:true,displayField:c.displayField,columns:c.columns,maxHeight:c.maxTreeHeight,shadow:false,rootVisible:c.rootVisible,manageHeight:false,width:c.getWidth(),height:300,listeners:{checkchange:{fn:c.onTreePickerFilterCheckChange,scope:c}},viewConfig:{listeners:{render:function(e){e.getEl().on("keypress",c.onPickerKeypress,c)}}}}),a=b.getView();var d=c.up("menu");if(d){d.add(b)}a.on("render",c.setPickerViewStyles,c);if(Ext.isIE9&&Ext.isStrict){a.on("highlightitem",c.repaintPickerView,c);a.on("unhighlightitem",c.repaintPickerView,c);a.on("afteritemexpand",c.repaintPickerView,c);a.on("afteritemcollapse",c.repaintPickerView,c)}return b},onTreePickerFilterCheckChange:function(d,c,a){var b=this;var e=b.getValue()==undefined?"":b.getValue();d.expand();d.checked=c;d.eachChild(function(f){f.set("checked",c);f.fireEvent("checkchange",f,c);if(f.hasChildNodes()){b.onTreePickerFilterCheckChange(f,c,b)}});b.setValue(d.get("deptId"));b.inputEl.focus();b.fireEvent("select",b,d)},setPickerViewStyles:function(a){a.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display},alignPicker:function(){var b=this,a;if(b.isExpanded){a=b.getPicker();if(b.matchFieldWidth){a.setWidth(b.bodyEl.getWidth())}if(a.isFloating()){b.doAlign()}}},onItemClick:function(b,a,c,f,d){this.selectItem(a)},onPickerKeypress:function(c,b){var a=c.getKey();if(a===c.ENTER||(a===c.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(a){var b=this;b.setValue(a.get("id"));b.inputEl.focus();b.fireEvent("select",b,a)},onExpand:function(){var e=this,c=e.picker,b=c.store,f=e.value;if(f){var d=b.getNodeById(f);if(d){c.selectPath(d.getPath())}}else{var a=e.store.hasOwnProperty("getRootNode");if(a){c.getSelectionModel().select(b.getRootNode())}}Ext.defer(function(){c.getView().focus()},1)},setValue:function(e){var d=this,a;d.value=e;if(d.store.loading){return d}var b=d.picker;var a,g="";var f="";if(b){a=b.getChecked();for(var c=0;c<a.length;c++){g=g+a[c].get(this.valueField)+",";f=f+a[c].get(this.displayField)+","}d.value=g}d.setRawValue(f);return d},getValue:function(){return this.value},onLoad:function(){var a=this.value;if(a){this.setValue(a)}},getSubmitValue:function(){return this.submitValue},getModelData:function(){var a=this,b=null;if(!a.disabled&&!a.isFileUpload()){b={};b[a.getName()]=a.getValue()}return b}});Ext.define("Ext.ux.data.Model",{extend:"Ext.data.Model",keyValidateNew:"add",validate:function(a){var b=this.callParent();if(a===this.keyValidateNew){b.removeAll(b.getByField("id"));return b}return b},isValidNew:function(){return this.validate(this.keyValidateNew).isValid()}});Ext.define("Ext.ux.data.Store",{extend:"Ext.data.Store",constructor:function(a){var b=this;if(a&&a.listeners&&a.listeners.load){a.listeners.load=Ext.Function.createInterceptor(a.listeners.load,b.onLoadStoreEvent)}if(b.listeners&&b.listeners.load){b.listeners.load=Ext.Function.createInterceptor(b.listeners.load,b.onLoadStoreEvent)}b.callParent(arguments)},onLoadStoreEvent:function(b,a,d,c){if(d==false){return false}return true},clone:function(){var a=Ext.create("Ext.data.Store",{model:this.model.modelName});this.data.each(function(b){this.add(b.copy())},a.data);return a}});Ext.define("Ext.ux.data.proxy.ZfProxy",{extend:"Ext.data.proxy.Ajax",alias:"proxy.zf",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},buildUrl:function(b){var a=this.getUrl(b);if(!a){throw new Error("You are using a ServerProxy but have not supplied it with a url.")}if(this.noCache){a=a+(a.substring(a.length-1)==="/"?"":"/")+Ext.String.format("{0}/{1}",this.cacheString,Ext.Date.now())}return a}});Ext.define("Ext.ux.grid.FiltersFeature",{extend:"Ext.grid.feature.Feature",alias:"feature.filters",uses:["Ext.ux.grid.menu.ListMenu","Ext.ux.grid.menu.RangeMenu","Ext.ux.grid.filter.BooleanFilter","Ext.ux.grid.filter.DateFilter","Ext.ux.grid.filter.DateTimeFilter","Ext.ux.grid.filter.ListFilter","Ext.ux.grid.filter.NumericFilter","Ext.ux.grid.filter.StringFilter"],autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor:function(a){var b=this;b.callParent(arguments);b.deferredUpdate=Ext.create("Ext.util.DelayedTask",b.reload,b);b.filters=b.createFiltersCollection();b.filterConfigs=a.filters},init:function(b){var c=this,a=c.view,d=a.headerCt;c.bindStore(a.getStore(),true);d.on("menucreate",c.onMenuCreate,c);a.on("refresh",c.onRefresh,c);b.on({scope:c,beforestaterestore:c.applyState,beforestatesave:c.saveState,beforedestroy:c.destroy});b.filters=c;b.addEvents("filterupdate")},createFiltersCollection:function(){return Ext.create("Ext.util.MixedCollection",false,function(a){return a?a.dataIndex:null})},createFilters:function(){var h=this,g=h.filters.getCount(),a=h.getGridPanel(),d=h.createFiltersCollection(),e=a.store.model,f=e.prototype.fields,i,c,b;if(g){b={};h.saveState(null,b)}function j(l,k,m){if(l&&(m||k)){i=f.get(l);c={dataIndex:l,type:(i&&i.type&&i.type.type)||"auto"};if(Ext.isObject(k)){Ext.apply(c,k)}d.replace(c)}}Ext.Array.each(h.filterConfigs,function(k){j(k.dataIndex,k)});Ext.Array.each(a.columnManager.getColumns(),function(k){if(k.filterable===false){d.removeAtKey(k.dataIndex)}else{j(k.dataIndex,k.filter,k.filterable)}});h.removeAll();if(d.items){h.initializeFilters(d.items)}if(g){h.applyState(null,b)}},initializeFilters:function(e){var d=this,f=e.length,b,c,a;for(b=0;b<f;b++){c=e[b];if(c){a=d.getFilterClass(c.type);c=c.menu?c:new a(Ext.apply({grid:d.grid},c));d.filters.add(c);Ext.util.Observable.capture(c,this.onStateChange,this)}}},onMenuCreate:function(c,b){var a=this;a.createFilters();b.on("beforeshow",a.onMenuBeforeShow,a)},onMenuBeforeShow:function(d){var c=this,b,a;if(c.showMenu){b=c.menuItem;if(!b||b.isDestroyed){c.createMenuItem(d);b=c.menuItem}a=c.getMenuFilter();if(a){b.setMenu(a.menu,false);b.setChecked(a.active);b.setDisabled(a.disabled===true)}b.setVisible(!!a);this.sep.setVisible(!!a)}},createMenuItem:function(b){var a=this;a.sep=b.add("-");a.menuItem=b.add({checked:false,itemId:"filters",text:a.menuFilterText,listeners:{scope:a,checkchange:a.onCheckChange,beforecheckchange:a.onBeforeCheck}})},getGridPanel:function(){return this.view.up("gridpanel")},applyState:function(b,e){var d=this,a,c;d.applyingState=true;d.clearFilters();if(e.filters){for(a in e.filters){if(e.filters.hasOwnProperty(a)){c=d.filters.get(a);if(c){c.setValue(e.filters[a]);c.setActive(true)}}}}d.deferredUpdate.cancel();if(d.local){d.reload()}delete d.applyingState;delete e.filters},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return(c.filters=b)},destroy:function(){var a=this;Ext.destroyMembers(a,"menuItem","sep");a.removeAll();a.clearListeners()},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(a){var b=this;if(b.store&&b.storeListeners){b.store.un(b.storeListeners)}if(a){b.storeListeners={scope:b};if(b.local){b.storeListeners.load=b.onLoad}else{b.storeListeners["before"+(a.buffered?"prefetch":"load")]=b.onBeforeLoad}a.on(b.storeListeners)}else{delete b.storeListeners}b.store=a},getMenuFilter:function(){var a=this.view.headerCt.getMenu().activeHeader;return a?this.filters.get(a.dataIndex):null},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(d,b){if(d!=="serialize"){var c=this,a=c.getGridPanel();if(b==c.getMenuFilter()){c.menuItem.setChecked(b.active,false)}if((c.autoReload||c.local)&&!c.applyingState){c.deferredUpdate.delay(c.updateBuffer)}c.updateColumnHeadings();if(!c.applyingState){a.saveState()}a.fireEvent("filterupdate",c,b)}},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var c=this.buildQuery(this.getFilterData());Ext.apply(b.params,c)},onLoad:function(a){a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var a=this,b=a.view.headerCt;if(b){b.items.each(function(d){var c=a.getFilter(d.dataIndex);d[c&&c.active?"addCls":"removeCls"](a.filterCls)})}},reload:function(){var b=this,a=b.view.getStore();if(b.local){a.clearFilter(true);a.filterBy(b.getRecordFilter());a.sort()}else{b.deferredUpdate.cancel();if(a.buffered){a.data.clear()}a.loadPage(1)}},getRecordFilter:function(){var d=[],a,b,c=this.lockingPartner;this.filters.each(function(e){if(e.active){d.push(e)}});if(c){c.filters.each(function(e){if(e.active){d.push(e)}})}a=d.length;return function(e){for(b=0;b<a;b++){if(!d[b].validateRecord(e)){return false}}return true}},addFilter:function(a){var f=this,c=f.getGridPanel().columnManager.getColumns(),b,h,e,g,d;for(b=0,h=c.length;b<h;b++){e=c[b];if(e.dataIndex===a.dataIndex){e.filter=a}}if(f.view.headerCt.menu){f.createFilters()}else{f.view.headerCt.getMenu()}for(b=0,g=f.filters.items.length;b<g;b++){d=f.filters.items[b];if(d.dataIndex===a.dataIndex){return d}}},addFilters:function(c){if(c){var b=this,a,d;for(a=0,d=c.length;a<d;a++){b.addFilter(c[a])}}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterItems:function(){var a=this;if(a.lockingPartner){return a.filters.items.concat(a.lockingPartner.filters.items)}return a.filters.items},getFilterData:function(){var c=this.getFilterItems(),g=[],j,b,f,h,e,a;for(j=0,b=c.length;j<b;j++){f=c[j];if(f.active){h=[].concat(f.serialize());for(e=0,a=h.length;e<a;e++){g.push({field:f.dataIndex,data:h[e]})}}}return g},buildQuery:function(b){var a={},c,h,j,e,k,d,g=b.length;if(!this.encode){for(c=0;c<g;c++){h=b[c];j=[this.paramPrefix,"[",c,"]"].join("");a[j+"[field]"]=h.field;e=j+"[data]";for(k in h.data){a[[e,"[",k,"]"].join("")]=h.data[k]}}}else{d=[];for(c=0;c<g;c++){h=b[c];d.push(Ext.apply({},{field:h.field},h.data))}if(d.length>0){a[this.paramPrefix]=Ext.JSON.encode(d)}}return a},cleanParams:function(c){if(this.encode){delete c[this.paramPrefix]}else{var b,a;b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(a in c){if(b.test(a)){delete c[a]}}}},getFilterClass:function(a){switch(a){case"auto":a="string";break;case"int":case"float":a="numeric";break;case"bool":a="boolean";break}return Ext.ClassManager.getByAlias("gridfilter."+a)}});Ext.define("Ext.ux.grid.FiltersDynamicFeature",{extend:"Ext.ux.grid.FiltersFeature",alias:"feature.dynamicfilters",uses:["Ext.ux.grid.menu.ListMenu","Ext.ux.grid.menu.RangeMenu","Ext.ux.grid.filter.BooleanFilter","Ext.ux.grid.filter.DateFilter","Ext.ux.grid.filter.DateTimeFilter","Ext.ux.grid.filter.ListFilter","Ext.ux.grid.filter.NumericFilter","Ext.ux.grid.filter.StringFilter","Ext.ux.grid.filter.TreepickerFilter"],autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor:function(a){var b=this;b.callParent(arguments);b.deferredUpdate=Ext.create("Ext.util.DelayedTask",b.reload,b);b.filters=b.createFiltersCollection();b.filterConfigs=a.filters},init:function(b){var c=this,a=c.view,d=a.headerCt;c.bindStore(a.getStore(),true);d.on("menucreate",c.onMenuCreate,c);a.on("refresh",c.onRefresh,c);b.on({scope:c,beforestaterestore:c.applyState,beforestatesave:c.saveState,beforedestroy:c.destroy});b.filters=c;b.addEvents("filterupdate")},createFiltersCollection:function(){return Ext.create("Ext.util.MixedCollection",false,function(a){return a?a.dataIndex:null})},createFilters:function(){var h=this,g=h.filters.getCount(),a=h.getGridPanel(),d=h.createFiltersCollection(),e=a.store.model,f=e.prototype.fields,i,c,b;if(g){b={};h.saveState(null,b)}function j(l,k,m){if(l&&(m||k)){i=f.get(l);c={dataIndex:l,type:(i&&i.type&&i.type.type)||"auto"};if(Ext.isObject(k)){Ext.apply(c,k)}d.replace(c)}}Ext.Array.each(h.filterConfigs,function(k){j(k.dataIndex,k)});Ext.Array.each(a.columnManager.getColumns(),function(k){if(k.filterable===false){d.removeAtKey(k.dataIndex)}else{j(k.dataIndex,k.filter,k.filterable)}});h.removeAll();if(d.items){h.initializeFilters(d.items)}if(g){h.applyState(null,b)}},initializeFilters:function(e){var d=this,f=e.length,b,c,a;for(b=0;b<f;b++){c=e[b];if(c){a=d.getFilterClass(c.type);c=c.menu?c:new a(Ext.apply({grid:d.grid},c));d.filters.add(c);Ext.util.Observable.capture(c,this.onStateChange,this)}}},onMenuCreate:function(c,b){var a=this;a.createFilters();b.on("beforeshow",a.onMenuBeforeShow,a)},onMenuBeforeShow:function(d){var c=this,b,a;if(c.showMenu){b=c.menuItem;if(!b||b.isDestroyed){c.createMenuItem(d);b=c.menuItem}a=c.getMenuFilter();if(a){b.setMenu(a.menu,false);b.setChecked(a.active);b.setDisabled(a.disabled===true)}b.setVisible(!!a);this.sep.setVisible(!!a)}},createMenuItem:function(b){var a=this;a.sep=b.add("-");a.menuItem=b.add({checked:false,itemId:"filters",text:a.menuFilterText,listeners:{scope:a,checkchange:a.onCheckChange,beforecheckchange:a.onBeforeCheck}})},getGridPanel:function(){return this.view.up("gridpanel")},applyState:function(b,e){var d=this,a,c;d.applyingState=true;d.clearFilters();if(e.filters){for(a in e.filters){if(e.filters.hasOwnProperty(a)){c=d.filters.get(a);if(c){c.setValue(e.filters[a]);c.setActive(true)}}}}d.deferredUpdate.cancel();if(d.local){d.reload()}delete d.applyingState;delete e.filters},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return(c.filters=b)},destroy:function(){var a=this;Ext.destroyMembers(a,"menuItem","sep");a.removeAll();a.clearListeners()},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(a){var b=this;if(b.store&&b.storeListeners){b.store.un(b.storeListeners)}if(a){b.storeListeners={scope:b};if(b.local){b.storeListeners.load=b.onLoad}else{b.storeListeners["before"+(a.buffered?"prefetch":"load")]=b.onBeforeLoad}a.on(b.storeListeners)}else{delete b.storeListeners}b.store=a},getMenuFilter:function(){var a=this.view.headerCt.getMenu().activeHeader;return a?this.filters.get(a.dataIndex):null},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(d,b){if(d!=="serialize"){var c=this,a=c.getGridPanel();if(b==c.getMenuFilter()){c.menuItem.setChecked(b.active,false)}if((c.autoReload||c.local)&&!c.applyingState){c.deferredUpdate.delay(c.updateBuffer)}c.updateColumnHeadings();if(!c.applyingState){a.saveState()}a.fireEvent("filterupdate",c,b)}},onBeforeLoad:function(a,b){var c=a.getProxy();c.doRequest=function(e,i,f){var h=this.getWriter(),g=this.buildRequest(e,i,f);g.jsonData=g.params;if(e.allowWrite()){g=h.write(g)}Ext.apply(g,{headers:this.headers,timeout:this.timeout,scope:this,callback:this.createRequestCallback(g,e,i,f),method:"POST",disableCaching:false});Ext.Ajax.request(g);return g};b.params=b.params||{};this.cleanParams(b.params);var d=this.buildQuery(this.getFilterData());Ext.apply(b.params,d)},onLoad:function(a){a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var a=this,b=a.view.headerCt;if(b){b.items.each(function(d){var c=a.getFilter(d.dataIndex);d[c&&c.active?"addCls":"removeCls"](a.filterCls)})}},reload:function(){var b=this,a=b.view.getStore();if(b.local){a.clearFilter(true);a.filterBy(b.getRecordFilter());a.sort()}else{b.deferredUpdate.cancel();if(a.buffered){a.data.clear()}a.loadPage(1)}},getRecordFilter:function(){var d=[],a,b,c=this.lockingPartner;this.filters.each(function(e){if(e.active){d.push(e)}});if(c){c.filters.each(function(e){if(e.active){d.push(e)}})}a=d.length;return function(e){for(b=0;b<a;b++){if(!d[b].validateRecord(e)){return false}}return true}},addFilter:function(a){var f=this,c=f.getGridPanel().columnManager.getColumns(),b,h,e,g,d;for(b=0,h=c.length;b<h;b++){e=c[b];if(e.dataIndex===a.dataIndex){e.filter=a}}if(f.view.headerCt.menu){f.createFilters()}else{f.view.headerCt.getMenu()}for(b=0,g=f.filters.items.length;b<g;b++){d=f.filters.items[b];if(d.dataIndex===a.dataIndex){return d}}},addFilters:function(c){if(c){var b=this,a,d;for(a=0,d=c.length;a<d;a++){b.addFilter(c[a])}}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterItems:function(){var a=this;if(a.lockingPartner){return a.filters.items.concat(a.lockingPartner.filters.items)}return a.filters.items},getFilterData:function(){var c=this.getFilterItems(),g=[],j,b,f,h,e,a;for(j=0,b=c.length;j<b;j++){f=c[j];if(f.active){h=[].concat(f.serialize());for(e=0,a=h.length;e<a;e++){g.push({field:f.dataIndex,data:h[e]})}}}return g},buildQuery:function(b){var a={},e,j,k,g,m,l,d,h=b.length,c;if(!this.encode){d={};for(j in b){filter=b[j];if(d[filter.field]){c=d[filter.field]}else{c={}}switch(filter.data.type){case"date":m="$"+filter.data.comparison;if(filter.data.comparison=="eq"){c=filter.data.value}else{c[m+"e"]=filter.data.value}break;case"treepicker":m="$in";l=filter.data.value;filter.data.value=l.substring(0,l.length-1);c[m]=filter.data.value.split(",");break;case"string":m="$regex";c[m]=filter.data.value;break;case"list":m="$in";c[m]=filter.data.value;break;case"numeric":if(filter.data.comparison=="eq"){m=filter.field;c=filter.data.value}else{m="$"+filter.data.comparison;c[m]=filter.data.value}break;case"boolean":m=filter.data.type;c=filter.data.value;break}d[filter.field]=c}a[this.paramPrefix]=d}else{d=[];for(e=0;e<h;e++){j=b[e];d.push(Ext.apply({},{field:j.field},j.data))}if(d.length>0){a[this.paramPrefix]=Ext.JSON.encode(d)}}return a},cleanParams:function(c){if(this.encode){delete c[this.paramPrefix]}else{var b,a;b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(a in c){if(b.test(a)){delete c[a]}}}},getFilterClass:function(a){switch(a){case"auto":a="string";break;case"int":case"float":a="numeric";break;case"bool":a="boolean";break}return Ext.ClassManager.getByAlias("gridfilter."+a)}});Ext.define("Ext.ux.grid.TransformGrid",{extend:"Ext.grid.Panel",constructor:function(q,f){f=Ext.apply({},f);q=this.table=Ext.get(q);var j=f.fields||[],c=f.columns||[],k=[],m=[],e=q.query("thead th"),h=0,l=e.length,g=q.dom,b,p,n,d,o,a;for(;h<l;++h){d=e[h];o=d.innerHTML;a="tcol-"+h;k.push(Ext.applyIf(j[h]||{},{name:a,mapping:"td:nth("+(h+1)+")/@innerHTML"}));m.push(Ext.applyIf(c[h]||{},{text:o,dataIndex:a,width:d.offsetWidth,tooltip:d.title,sortable:true}))}if(f.width){b=f.width}else{b=q.getWidth()+1}if(f.height){p=f.height}Ext.applyIf(f,{store:{data:g,fields:k,proxy:{type:"memory",reader:{record:"tbody tr",type:"xml"}}},columns:m,width:b,height:p});this.callParent([f]);if(f.remove!==false){g.parentNode.removeChild(g)}},onDestroy:function(){this.callParent();this.table.remove();delete this.table}});Ext.define("Ext.ux.grid.column.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",constructor:function(){this.addEvents("checkchange");this.callParent(arguments)},processEvent:function(d,g,j,a,f,c){if(d=="mousedown"||(d=="keydown"&&(c.getKey()==c.ENTER||c.getKey()==c.SPACE))){var b=g.panel.store.getAt(a),h=this.dataIndex,i=!b.get(h);b.set(h,i);this.fireEvent("checkchange",this,a,i);return false}else{return this.callParent(arguments)}},renderer:function(b){var c=Ext.baseCSSPrefix,a=[c+"grid-checkcolumn"];if(b){a.push(c+"grid-checkcolumn-checked")}return'<div class="'+a.join(" ")+'">&#160;</div>'}});Ext.define("Ext.ux.grid.filter.Filter",{extend:"Ext.util.Observable",active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents("activate","deactivate","serialize","update");Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(a);this.init(a);if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}},destroy:function(){if(this.menu){this.menu.destroy()}this.clearListeners()},init:Ext.emptyFn,createMenu:function(a){a.plain=true;return Ext.create("Ext.menu.Menu",a)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true},serialize:function(){var a=this.getSerialArgs();this.fireEvent("serialize",a,this);return a},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}}}});Ext.define("Ext.ux.grid.filter.BooleanFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.boolean",defaultValue:false,yesText:"Yes",noText:"No",init:function(a){var c=Ext.id();this.options=[Ext.create("Ext.menu.CheckItem",{text:this.yesText,group:c,checked:this.defaultValue===true}),Ext.create("Ext.menu.CheckItem",{text:this.noText,group:c,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var b=0;b<this.options.length;b++){this.options[b].on("click",this.fireUpdate,this);this.options[b].on("checkchange",this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(a){this.options[a?0:1].setChecked(true)},getSerialArgs:function(){var a={type:"boolean",value:this.getValue()};return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});Ext.define("Ext.ux.grid.filter.DateFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.date",uses:["Ext.picker.Date","Ext.menu.Menu"],afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:true,width:125},onText:"On",pickerOpts:{},init:function(d){var g=this,c,e,a,f,b;c=Ext.apply(g.pickerOpts,{xtype:"datepicker",minDate:g.minDate,maxDate:g.maxDate,format:g.dateFormat,listeners:{scope:g,select:g.onMenuSelect}});g.fields={};for(e=0,a=g.menuItems.length;e<a;e++){f=g.menuItems[e];if(f!=="-"){b={itemId:"range-"+f,text:g[f+"Text"],menu:Ext.create("Ext.menu.Menu",{plain:true,items:[Ext.apply(c,{itemId:f,listeners:{select:g.onPickerSelect,scope:g}})]}),listeners:{scope:g,checkchange:g.onCheckChange}};f=g.fields[f]=Ext.create("Ext.menu.CheckItem",b)}g.menu.add(f)}g.values={}},onCheckChange:function(e,d){var c=this,b=e.menu.items.first(),f=b.itemId,a=c.values;if(d){a[f]=b.getValue()}else{delete a[f]}c.setActive(c.isActivatable());c.fireEvent("update",c)},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide()}},onMenuSelect:function(c,b){var a=this.fields,d=this.fields[c.itemId];d.setChecked(true);if(d==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(d==a.after&&this.getFieldValue("before")<b){a.before.setChecked(false,true)}else{if(d==a.before&&this.getFieldValue("after")>b){a.after.setChecked(false,true)}}}this.fireEvent("update",this);c.up("menu").hide()},getValue:function(){var b,a={};for(b in this.fields){if(this.fields[b].checked){a[b]=this.getFieldValue(b)}}return a},setValue:function(c,b){var a;for(a in this.fields){if(c[a]){this.getPicker(a).setValue(c[a]);this.fields[a].setChecked(true)}else{if(!b){this.fields[a].setChecked(false)}}}this.fireEvent("update",this)},isActivatable:function(){var a;for(a in this.fields){if(this.fields[a].checked){return true}}return false},getSerialArgs:function(){var a=[];for(var b in this.fields){if(this.fields[b].checked){a.push({type:"date",comparison:this.compareMap[b],value:Ext.Date.format(this.getFieldValue(b),this.dateFormat)})}}return a},getFieldValue:function(a){return this.values[a]},getPicker:function(a){return this.fields[a].menu.items.first()},validateRecord:function(b){var c,e,d=b.get(this.dataIndex),a=Ext.Date.clearTime;if(!Ext.isDate(d)){return false}d=a(d,true).getTime();for(c in this.fields){if(this.fields[c].checked){e=a(this.getFieldValue(c),true).getTime();if(c=="before"&&e<=d){return false}if(c=="after"&&e>=d){return false}if(c=="on"&&e!=d){return false}}}return true},onPickerSelect:function(b,a){this.values[b.itemId]=a;this.fireEvent("update",this)}});Ext.define("Ext.ux.grid.filter.DateTimeFilter",{extend:"Ext.ux.grid.filter.DateFilter",alias:"gridfilter.datetime",dateDefaults:{xtype:"datepicker",format:"m/d/Y"},timeDefaults:{xtype:"timepicker",width:100,height:200,format:"g:i A"},dockDefaults:{dock:"top",buttonText:"Filter"},selectDateToFilter:true,positionDatepickerFirst:true,reTime:/\s(am|pm)/i,reItemId:/\w*-(\w*)$/,addTimeSelection:function(c,k){var h=this,l=k.getSelectionModel().getSelection(),b,g,j,a,e=0,f=[],d=["setHours","setMinutes","setSeconds","setMilliseconds"];if(l.length){b=l[0].get("disp");f=b.replace(h.reTime,"").split(":");for(g=f.length;e<g;e++){j=d[e];a=f[e];if(a){c[j](parseInt(a,10))}}}return c},init:function(b){var l=this,a=Ext.applyIf(l.date||{},l.dateDefaults),n=Ext.applyIf(l.time||{},l.timeDefaults),d=l.dock,c={click:{scope:l,click:l.onMenuSelect},select:{scope:l,select:l.onMenuSelect}},j,f,h,m,g,k=[a,n],e=0;if(!l.positionDatepickerFirst){k=k.reverse();e=1}j=Ext.apply(l.pickerOpts,{xtype:!d?"container":"panel",layout:"hbox",items:k});if(!d){if(l.selectDateToFilter){a.listeners=c.select}else{n.listeners=c.select}}else{if(d){l.selectDateToFilter=null;if(d.dockedItems){j.dockedItems=d.dockedItems;j.dockedItems.items[d.bindToItem||0].listeners=c.click}else{if(Ext.isBoolean(d)){d={}}d=Ext.applyIf(d,l.dockDefaults);j.dockedItems={xtype:"toolbar",dock:d.dock,items:[{xtype:"button",text:d.buttonText,flex:1,listeners:c.click}]}}}}l.fields={};for(f=0,h=l.menuItems.length;f<h;f++){m=l.menuItems[f];if(m!=="-"){j.items[e].itemId=m;g={itemId:"range-"+m,text:l[m+"Text"],menu:Ext.create("Ext.menu.Menu",{items:j}),listeners:{scope:l,checkchange:l.onCheckChange}};m=l.fields[m]=Ext.create("Ext.menu.CheckItem",g)}l.menu.add(m)}l.values={}},onCheckChange:function(e,d){var c=this,h=e.menu,b=h.down("timepicker"),f=h.down("datepicker"),g=f.itemId,a=c.values;if(d){a[g]=c.addTimeSelection(f.value,b)}else{delete a[g]}c.setActive(c.isActivatable());c.fireEvent("update",c)},onMenuSelect:function(d,c){var e=this,g=e.menu,b=g.getFocusEl().itemId.replace(e.reItemId,"$1"),a=e.fields,f;d=g.queryById(b);f=e.fields[d.itemId];f.setChecked(true);if(f==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(f==a.after&&e.getFieldValue("before")<c){a.before.setChecked(false,true)}else{if(f==a.before&&e.getFieldValue("after")>c){a.after.setChecked(false,true)}}}e.fireEvent("update",e);d.ownerCt.ownerCt.hide()},getSerialArgs:function(){var d=this,c,a=d.fields,b=[];for(c in a){if(a[c].checked){b.push({type:"datetime",comparison:d.compareMap[c],value:Ext.Date.format(d.getFieldValue(c),(d.date.format||d.dateDefaults.format)+" "+(d.time.format||d.timeDefaults.format))})}}return b},setValue:function(f,c){var d=this,a=d.fields,b,g,e;for(b in a){g=f[b];if(g){e=d.menu.down('datepicker[itemId="'+b+'"]');e.update(g);e.value=g;a[b].setChecked(true)}else{if(!c){a[b].setChecked(false)}}}d.fireEvent("update",d)},validateRecord:function(a){var c=this,b,e,d=a.get(c.dataIndex);if(!Ext.isDate(d)){return false}d=d.getTime();for(b in c.fields){if(c.fields[b].checked){e=c.getFieldValue(b).getTime();if(b=="before"&&e<=d){return false}if(b=="after"&&e>=d){return false}if(b=="on"&&e!=d){return false}}}return true}});Ext.define("Ext.ux.grid.filter.ListFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.list",phpMode:false,init:function(a){this.dt=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},createMenu:function(a){var b=Ext.create("Ext.ux.grid.menu.ListMenu",a);b.on("checkchange",this.onCheckChange,this);return b},getValue:function(){return this.menu.getSelected()},setValue:function(a){this.menu.setSelected(a);this.fireEvent("update",this)},isActivatable:function(){return this.getValue().length>0},getSerialArgs:function(){return{type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(a){var b=this.getValue();return Ext.Array.indexOf(b,a.get(this.dataIndex))>-1}});Ext.define("Ext.ux.grid.filter.NumericFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.numeric",uses:["Ext.form.field.Number"],createMenu:function(a){var b=this,c;c=Ext.create("Ext.ux.grid.menu.RangeMenu",a);c.on("update",b.fireUpdate,b);return c},getValue:function(){return this.menu.getValue()},setValue:function(a){this.menu.setValue(a)},isActivatable:function(){var a=this.getValue(),b;for(b in a){if(a[b]!==undefined){return true}}return false},getSerialArgs:function(){var c,b=[],a=this.menu.getValue();for(c in a){b.push({type:"numeric",comparison:c,value:a[c]})}return b},validateRecord:function(a){var d=a.get(this.dataIndex),b=this.getValue(),c=Ext.isNumber;if(c(b.eq)&&d!=b.eq){return false}if(c(b.lt)&&d>=b.lt){return false}if(c(b.gt)&&d<=b.gt){return false}return true}});Ext.define("Ext.ux.grid.filter.StringFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.string",iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:true,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:true,labelCls:"ux-rangemenu-icon "+this.iconCls,hideEmptyLabel:false,labelSeparator:"",labelWidth:29,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(b){b.stopPropagation()}}}});this.inputItem=Ext.create("Ext.form.field.Text",a);this.menu.add(this.inputItem);this.menu.showSeparator=false;this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this)},isActivatable:function(){return this.inputItem.getValue().length>0},getSerialArgs:function(){return{type:"string",value:this.getValue()}},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="string"){return(this.getValue().length===0)}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide();return}this.updateTask.delay(this.updateBuffer)}});Ext.define("Ext.ux.grid.filter.TreepickerFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.treepicker",iconCls:"ux-gridfilter-text-icon",selectOnFocus:true,width:125,init:function(a){this.inputItem=Ext.create("Ext.ux.TreePickerFilter",a);this.inputItem.on("select",this.onInputKeyUp,this);this.menu.add(this.inputItem);this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this)},isActivatable:function(){var a=this.inputItem.rawValue;return a==undefined?false:true},getSerialArgs:function(){return{type:"treepicker",value:this.getValue()}},validateRecord:function(a){var c=a.get(this.dataIndex);if(typeof c!="string"){var b=this.getValue();return(this.getValue())}return c.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(b,a,d,c){this.updateTask.delay(this.updateBuffer)}});Ext.define("Ext.ux.grid.menu.ListMenu",{extend:"Ext.menu.Menu",idField:"id",labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,plain:true,constructor:function(b){var e=this,c,d,a,f;e.selected=[];e.addEvents("checkchange");e.callParent(arguments);if(!e.store&&!e.options){e.options=e.grid.store.collect(e.dataIndex,false,true)}if(!e.store&&e.options){c=[];for(d=0,a=e.options.length;d<a;d++){f=e.options[d];switch(Ext.type(f)){case"array":c.push(f);break;case"object":c.push([f[e.idField],f[e.labelField]]);break;default:if(f!=null){c.push([f,f])}}}e.store=Ext.create("Ext.data.ArrayStore",{fields:[e.idField,e.labelField],data:c,listeners:{load:e.onLoad,scope:e}});e.loaded=true;e.autoStore=true}else{e.add({text:e.loadingText,iconCls:"loading-indicator"});e.store.on("load",e.onLoad,e)}},destroy:function(){var b=this,a=b.store;if(a){if(b.autoStore){a.destroyStore()}else{a.un("unload",b.onLoad,b)}}b.callParent()},show:function(){var a=this;if(a.loadOnShow&&!a.loaded&&!a.store.loading){a.store.load()}a.callParent()},onLoad:function(c,b){var g=this,f,h,d,a,e={checkchange:g.checkChange,scope:g};Ext.suspendLayouts();g.removeAll(true);f=g.single?Ext.id():null;for(d=0,a=b.length;d<a;d++){h=b[d].get(g.idField);g.add(Ext.create("Ext.menu.CheckItem",{text:b[d].get(g.labelField),group:f,checked:Ext.Array.contains(g.selected,h),hideOnClick:false,value:h,listeners:e}))}g.loaded=true;Ext.resumeLayouts(true);g.fireEvent("load",g,b)},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.value==a[c]){d.setChecked(true,true)}}})}},checkChange:function(b,a){var c=[];this.items.each(function(d){if(d.checked){c.push(d.value)}});this.selected=c;this.fireEvent("checkchange",b,a)}});Ext.define("Ext.ux.grid.menu.RangeMenu",{extend:"Ext.menu.Menu",fieldCls:"Ext.form.field.Number",itemIconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},fieldLabels:{gt:"Greater Than",lt:"Less Than",eq:"Equal To"},menuItemCfgs:{emptyText:"Enter Number...",selectOnFocus:false,width:155},menuItems:["lt","gt","-","eq"],plain:true,constructor:function(a){var f=this,c,g,b,e,h,d,j;f.callParent(arguments);c=f.fields=f.fields||{};g=f.fieldCfg=f.fieldCfg||{};f.addEvents("update");f.updateTask=Ext.create("Ext.util.DelayedTask",f.fireUpdate,f);for(b=0,e=f.menuItems.length;b<e;b++){h=f.menuItems[b];if(h!=="-"){d={itemId:"range-"+h,enableKeyEvents:true,hideEmptyLabel:false,labelCls:"ux-rangemenu-icon "+f.itemIconCls[h],labelSeparator:"",labelWidth:29,listeners:{scope:f,change:f.onInputChange,keyup:f.onInputKeyUp,el:{click:this.stopFn}},activate:Ext.emptyFn,deactivate:Ext.emptyFn};Ext.apply(d,Ext.applyIf(c[h]||{},g[h]),f.menuItemCfgs);j=d.fieldCls||f.fieldCls;h=c[h]=Ext.create(j,d)}f.add(h)}},stopFn:function(a){a.stopPropagation()},fireUpdate:function(){this.fireEvent("update",this)},getValue:function(){var b={},a=this.fields,c,d;for(c in a){if(a.hasOwnProperty(c)){d=a[c];if(d.isValid()&&d.getValue()!==null){b[c]=d.getValue()}}}return b},setValue:function(d){var c=this,a=c.fields,b,e;for(b in a){if(a.hasOwnProperty(b)){e=a[b];e.suspendEvents();e.setValue(b in d?d[b]:"");e.resumeEvents()}}c.fireEvent("update",c)},onInputKeyUp:function(b,a){if(a.getKey()===a.RETURN&&b.isValid()){a.stopEvent();this.hide()}},onInputChange:function(f){var e=this,c=e.fields,b=c.eq,d=c.gt,a=c.lt;if(f==b){if(d){d.setValue(null)}if(a){a.setValue(null)}}else{b.setValue(null)}this.updateTask.delay(this.updateBuffer)}});Ext.define("Ext.ux.grid.plugin.RowEditing",{extend:"Ext.grid.plugin.RowEditing",alias:"plugin.ux.rowediting",init:function(a){var b=this;b.addEvents("canceledit");b.callParent(arguments);a.addEvents("canceledit");a.relayEvents(b,["canceledit"])},cancelEdit:function(){var a=this;if(a.editing){a.getEditor().cancelEdit();a.callParent(arguments);a.fireEvent("canceledit",a.context)}},});
/*!
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.ux.layout.FitAll",{extend:"Ext.layout.container.Fit",alias:"layout.fitall",onLayout:function(){var b=this;b.callParent();var a=b.getLayoutTargetSize();b.owner.items.each(function(c){b.setItemBox(c,a)})},getTargetBox:function(){return this.getLayoutTargetSize()},setItemBox:function(c,b){var a=this;if(c&&b.height>0){if(c.layoutManagedWidth==2){b.width=undefined}if(c.layoutManagedHeight==2){b.height=undefined}c.getEl().position("absolute",null,0,0);a.setItemSize(c,b.width,b.height)}}});